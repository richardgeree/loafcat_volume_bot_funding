<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LOAFCAT Whale Checker</title>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  <style>
    /* (same CSS, unchanged) */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #fef6dc, #f9f1d3);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      color: #6b5b1a;
    }

    main {
      max-width: 480px;
      background: #ffffffcc;
      margin: 2rem auto;
      padding: 2rem 2.5rem;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(244, 192, 75, 0.3);
      text-align: center;
    }

    img#logo {
      display: block;
      margin: 0 auto 1rem auto;
      width: 150px;
      height: auto;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      color: #f4c04b;
      text-shadow: 0 1px 3px rgba(180, 140, 10, 0.7);
    }

    p.subtitle {
      color: #a88722;
      margin-bottom: 2rem;
      font-size: 1rem;
      font-weight: 500;
    }

    button#connect-button {
      background-color: #f4c04b;
      color: #3e2e00;
      border: none;
      border-radius: 8px;
      padding: 1rem 2rem;
      font-size: 1.2rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      box-shadow: 0 4px 12px rgba(244, 192, 75, 0.5);
      margin-bottom: 1.5rem;
      width: 100%;
      max-width: 320px;
      font-weight: 700;
      letter-spacing: 0.05em;
    }

    button#connect-button:hover {
      background-color: #d9a722;
    }

    pre#status {
      background: #fff8d1;
      padding: 1rem 1.2rem;
      border-radius: 10px;
      color: #6b5b1a;
      font-size: 1rem;
      text-align: left;
      min-height: 6rem;
      overflow-wrap: break-word;
      white-space: pre-wrap;
      box-shadow: inset 0 0 5px #f4c04baa;
      user-select: text;
      max-width: 100%;
      margin: 0 auto 1rem auto;
    }

    a#tg-link {
      display: inline-block;
      background-color: #f4c04b;
      color: #3e2e00;
      text-decoration: none;
      padding: 0.8rem 1.8rem;
      border-radius: 8px;
      font-weight: 700;
      letter-spacing: 0.05em;
      box-shadow: 0 4px 12px rgba(244, 192, 75, 0.5);
      transition: background-color 0.3s ease;
      margin-top: 0.5rem;
    }

    a#tg-link:hover {
      background-color: #d9a722;
    }

    footer {
      font-size: 0.8rem;
      color: #a88722;
      padding: 1rem 1.5rem;
      text-align: center;
      background: #fef6dc;
      border-top: 1px solid #f4c04b;
      line-height: 1.4;
      max-width: 480px;
      margin: 1rem auto 2rem;
      border-radius: 0 0 16px 16px;
    }

    footer small {
      display: block;
      margin-top: 0.5rem;
      font-style: italic;
      color: #cbb251;
    }

    a {
      color: #f4c04b;
      text-decoration: none;
      font-weight: 600;
    }

    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <main>
    <img id="logo" src="https://loafcat.me/_next/static/media/logo.8f283c4e.gif" alt="LOAFCAT Logo" />
    <h1>LOAFCAT Whale Checker üê≥</h1>
    <p class="subtitle">
      Verify your LOAFCAT holdings anonymously.<br />
      Connect your Phantom wallet to confirm you hold at least 250M LOAFCAT tokens and get a private invite link for Telegram group.
    </p>

    <button id="connect-button">Connect Phantom Wallet</button>
    <pre id="status" aria-live="polite" role="status" style="white-space: normal;"></pre>

    <!-- Telegram link appears here if whale -->
   <a id="tg-link" href="https://t.me/tobinbellsaw" target="_blank" rel="noopener noreferrer" style="display:none;">
  Send your unique verification code above to Tobin on Telegram and enjoy the ride! üéâ
</a>

  </main>

  <footer>
    ¬© 2025 LoafCat Studios. All rights reserved.<br />
    This document is for informational purposes only and does not constitute investment advice, an offer, or a solicitation to buy or sell any financial instrument.<br />
    Participation in digital assets involves significant risk. Past performance is not indicative of future results.<br />
    Prospective participants should conduct their own due diligence and consult with professional advisors before making any investment decisions.<br /><br />

    Powered by <a href="https://github.com" target="_blank" rel="noopener noreferrer">GitHub</a>, <a href="https://vercel.com" target="_blank" rel="noopener noreferrer">Vercel</a>, <a href="https://www.quicknode.com" target="_blank" rel="noopener noreferrer">QuickNode</a>.
  </footer>

  <script>
    const connectButton = document.getElementById("connect-button");
    const statusText = document.getElementById("status");
    const tgLink = document.getElementById("tg-link");

    const LOAFCAT_MINT = "LoafdJ3WSAvsrx3zppSGKA6sRvL9GrRrU1iRV7HkLkm";
    const MIN_BALANCE = 250_000_000;

    function generateCodeFromWallet(walletAddress) {
      let hash = 0;
      for (let i = 0; i < walletAddress.length; i++) {
        hash = (hash << 5) - hash + walletAddress.charCodeAt(i);
        hash |= 0;
      }
      return Math.abs(hash).toString(36).toUpperCase().slice(0, 8);
    }

    connectButton.addEventListener("click", async () => {
      tgLink.style.display = "none";
      const provider = window.solana;

      if (!provider || !provider.isPhantom) {
        alert("Phantom Wallet not found. Please install it from https://phantom.app");
        return;
      }

      try {
        statusText.textContent = "Connecting to wallet...";
        const resp = await provider.connect();
        const publicKey = resp.publicKey.toString();
        statusText.textContent = `üîó Connected: ${publicKey}\nChecking LOAFCAT balance...`;

        const connection = new solanaWeb3.Connection(
          "https://bold-shy-bush.solana-mainnet.quiknode.pro/12de2fb6da10bb23321dea265062809717f23e54/",
          "confirmed"
        );

        const tokenAccounts = await connection.getParsedTokenAccountsByOwner(
          new solanaWeb3.PublicKey(publicKey),
          { programId: new solanaWeb3.PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA") }
        );

        let found = false;
        let amount = 0;

        tokenAccounts.value.forEach(({ account }) => {
          const info = account.data.parsed.info;
          if (info.mint === LOAFCAT_MINT) {
            found = true;
            amount = info.tokenAmount.amount / Math.pow(10, info.tokenAmount.decimals);
          }
        });

        if (!found) {
          statusText.textContent = "‚ùå You currently hold 0 LOAFCAT.\nStep into the bakery and grab your first loaf ‚Äî the freshest bread and warmest paws await!";
          return;
        }

if (amount >= MIN_BALANCE) {
  const code = generateCode(publicKey);
  statusText.innerHTML = `üêæ Welcome to the LOAFCAT Whales! üê≥üçû You‚Äôre the freshest loaf in our bakery ‚Äî together we rise mighty and unstoppable!<br><br>
  <strong>Your <span style="color:#c08c00;">LOAFCAT Whale Code</span>:</strong><br>
  <code style="font-size: 1.1rem; background: #fff2b2; padding: 6px 12px; border-radius: 6px; display: inline-block; margin-top: 0.3rem;">${code}</code><br><br>
  Your LOAFCAT balance: ${amount.toLocaleString()}`;

  tgLink.style.display = "inline-block"; // üî• THIS LINE is what shows the button
}


        } else {
          statusText.textContent = `ü´∂ Keep kneading! Your loaf‚Äôs almost baked ‚Äî 250M LOAFCAT is just ahead, and the bakery grows stronger with you.\nYour current balance: ${amount.toLocaleString()}`;
        }

      } catch (err) {
        console.error("üí• Error after wallet connection:", err);
        statusText.textContent = `‚ùå Something went wrong after connecting:\n${err.message || err}`;
      }
    });
  </script>
</body>
</html>
